<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>matlab运算技巧 - Less Is More</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="aice" /><meta name="description" content="一、运算速度 优先使用内建函数，尤其在遇到很多for循环情况时，多使用内建函数来代替循环，如:bsxfun、arrayfun、spfun、st" />






<meta name="generator" content="Hugo 0.52 with even 4.0.0" />


<link rel="canonical" href="http://aicesun.github.io/post/matlabskill/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">


<link href="/dist/even.93844dae.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="matlab运算技巧" />
<meta property="og:description" content="一、运算速度 优先使用内建函数，尤其在遇到很多for循环情况时，多使用内建函数来代替循环，如:bsxfun、arrayfun、spfun、st" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://aicesun.github.io/post/matlabskill/" /><meta property="article:published_time" content="2015-07-13T01:37:56&#43;08:00"/>
<meta property="article:modified_time" content="2015-07-13T01:37:56&#43;08:00"/>

<meta itemprop="name" content="matlab运算技巧">
<meta itemprop="description" content="一、运算速度 优先使用内建函数，尤其在遇到很多for循环情况时，多使用内建函数来代替循环，如:bsxfun、arrayfun、spfun、st">


<meta itemprop="datePublished" content="2015-07-13T01:37:56&#43;08:00" />
<meta itemprop="dateModified" content="2015-07-13T01:37:56&#43;08:00" />
<meta itemprop="wordCount" content="1410">



<meta itemprop="keywords" content="MATLAB," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="matlab运算技巧"/>
<meta name="twitter:description" content="一、运算速度 优先使用内建函数，尤其在遇到很多for循环情况时，多使用内建函数来代替循环，如:bsxfun、arrayfun、spfun、st"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Less Is More</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Less Is More</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">matlab运算技巧</h1>

      <div class="post-meta">
        <span class="post-time"> 2015-07-13 </span>
        <div class="post-category">
            <a href="/categories/matlab/"> MATLAB </a>
            </div>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li>
<ul>
<li><a href="#一-运算速度">一、运算速度</a></li>
<li><a href="#二-内存使用">二、内存使用</a></li>
<li><a href="#三-部分函数及向量化操作">三、部分函数及向量化操作</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
  </div>
</div>
    <div class="post-content">
      

<h3 id="一-运算速度">一、运算速度</h3>

<ul>
<li>优先使用内建函数，尤其在遇到很多for循环情况时，多使用内建函数来代替循环，如:bsxfun、arrayfun、spfun、structfun，因为内建函数 使用C来进行构造，速度比循环快。</li>
<li>使用向量化的处理方式，而不是循环。</li>
<li>多重循环次数不同时，外循环小于内循环次数。</li>
<li>使用有效算法：比如<code>A\B</code>比<code>inv(A)*B</code>运算要快得多。</li>
<li>函数比脚本快，因为函数被编译为P代码，只装入内存一次，脚本需要逐行运行，每次都要装入内存。</li>
<li>Matlab按行处理命令，所以一行最好只写一个操作命令。</li>
<li>大型矩阵预先定义维数。动态定维很费时间。可以先创建一个小矩阵，然后用repmat构建。</li>
<li>复数写成a+bi而不是a+b*i的形式，这样matlab将其认为是复数常数，否则会将其解释为一个没有定义数据结构和数组大小的变量。</li>
<li>用profiler和profile函数监控代码运行时间。</li>
<li>如果还是慢，换python、fortran、C吧。</li>
</ul>

<h3 id="二-内存使用">二、内存使用</h3>

<p>Matlab使用堆管理内存，运行会产生内存碎片，有很多闲置空间。
Pack命令，可以将内存中Matlab变量暂存在磁盘，然后再用空间的连续空间来存储变量。出现put of memory时，通过pack来重新分配内存，但是因为交换数据，所以速度慢。
同时可以周期性将数据存入磁盘进行保存，然后从内存去除变量再继续计算。对于大部分元素为0的矩阵，保存为稀疏矩阵，因为其占用内存少，且比满秩矩阵运算快，可以用sparse函数进行转换。</p>

<h3 id="三-部分函数及向量化操作">三、部分函数及向量化操作</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span></pre></td>
<td class="lntd">
<pre class="chroma">`A(:)` 返回矩阵所有元素，构成一列向量
	&gt;&gt;A=rand(2)
	A =
    	0.8523    0.6717
    	0.9833    0.1392
	&gt;&gt;A(:)&#39;
    	0.8523    0.9833    0.6717    0.1392
`a(~sum(abs(a),2),:)=[];a(:,~sum(abs(a),1))=[]` 去掉矩阵中全为0的行或者列
	&gt;&gt;a(1:size(A),1:size(A))=A
    	0.8523    0.6717         0
	0.9833    0.1392         0
	0         0         	 0
	&gt;&gt;a(~sum(abs(a),2),:)=[];a(:,~sum(abs(a),1))=[]
	0.8523    0.6717
	0.9833    0.1392
`accumarray` 类似于sum(A(subs))=val,subs提供位置，val提供值，然后把相同位置的值加起来，空位置默认补0.
	&gt;&gt;val = [1, 2, 3, 4];
	&gt;&gt;subs=[ 1,2; 1,1; 2,1; 1,1];
	&gt;&gt;A=accumarray(subs,val);
	6     1
	3     0
	&gt;&gt;subs = [1 1; 2 1; 2 3; 2 1; 2 3];
	&gt;&gt;A = accumarray(subs, 1, [2 4]); %表示val为2行4列值为1的矩阵
	1     0     0     0
	2     0     2     0
`array(and(array&gt;a,array&lt;b))=0`
	&gt;&gt;array=rand(3)
	0.3816    0.6117    0.1935
	0.8145    0.6756    0.0181
	0.0446    0.8328    0.5398
	&gt;&gt;array(and(array&gt;0.5,array&lt;0.8))=0
	0.3816         0    0.1935
	0.8145         0    0.0181
	0.0446    0.8328         0
`arrayfun` 用于对数组中每个元素进行相同的函数操作
	&gt;&gt;s(1).f1 = rand(3, 6);
	&gt;&gt;s(2).f1 = magic(12);
	&gt;&gt;s(3).f1 = ones(5, 10);
	&gt;&gt;counts = arrayfun(@(x) numel(x.f1), s); %计算每个矩阵个数
	&gt;&gt;counts =
	18   144    50
	&gt;&gt;[nrows, ncols] = arrayfun(@(x) size(x.f1), s); %计算每个矩阵行列值
	nrows =
	3    12     5
	ncols =
	6    12    10
	&gt;&gt;t = s;t(1).f1(:)=0;u = s;u(2).f1(:)=0;
	&gt;&gt;same = arrayfun(@(x,y) isequal(x.f1, y.f1), u, t)
	0    0    1
`bsxfun` 对数组间元素逐个进行计算
	&gt;&gt;A = magic(3)
	A =
	8     1     6
	3     5     7
	4     9     2
	&gt;&gt;mean(A)
	ans =
	5     5     5
	&gt;&gt;A = bsxfun(@minus, A, mean(A)) %相当于A-mean(A)
	 3    -4     1
	-2     0     2
	-1     4    -3
	&gt;&gt;a=randn(3,1),b=randn(1,2)
	a =	
	-1.5723
	0.3676
	-0.1402
	b =
	-0.0153    0.2528
	&gt;&gt;c=bsxfun(@plus,a,b) %将a和b先复制扩展，再做运算
	c =
   	-1.5876   -1.3195
     0.3523    0.6204
   	-0.1555    0.1126</pre></td></tr></table>
</div>
</div>
<p><strong>cellfun</strong> 类似于arrayfun，对数组进行相同运算
<strong>spfun</strong> 对稀疏矩阵非零值进行运算
<strong>sparse</strong> 生成稀疏矩阵函数
<strong>intersect</strong> 取交集
<strong>unique</strong> 取各自独立的部分
<strong>union</strong> 取并集
<strong>fig=plot(A); delete(fig)</strong> 删除某个图像
<strong>unique</strong> 统计互异元素出现的次数<br />
<strong>diag</strong> 生成对角阵和提取对角元素
<strong>flipud</strong> 上下对称交换
<strong>fliplr</strong> 左右对称交换
<strong>rot90(A,n)</strong> 逆时针旋转90°，n次
<strong>numel(A)</strong> 返回单元个数
<strong>regexp</strong> 用于对字符串进行查找，大小写敏感
<strong>regexpi</strong> 用于对字符串进行查找，大小写不敏感
<strong>regexprep</strong> 用于对字符串进行查找并替换
<strong>randn</strong> 产生正态随机数
<strong>randn</strong> 产生正态随机矩阵
<strong>randsrc</strong> 产生随机数组
<strong>unidrnd</strong> 产生一组离散均匀随机数
<strong>isequal</strong> 判断若干个给定的数组容量是否是相等的 <code>~=</code>
<strong>cumtrapz</strong> 基于梯形法则的数值积分公式
<strong>dbstop if error</strong> 遇到错误时,终止M文件运行,并停在错误行,<strong>dbcount</strong> 从断点处恢复运行
<strong>system</strong> 执行windows命令，批处理，exe都可以，命令前加！也可以
<a href="http://www.ee.columbia.edu/~marios/matlab/matlab_tricks.html">see more</a>
<a href="http://www.zhihu.com/question/24499729">from高大上的知乎</a></p>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">aice</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">2015-07-13</span>
  </p>
  
  
</div><footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/matlab/">MATLAB</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/python1/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">计算PGA的python程序</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/guiyihua/">
            <span class="next-text nav-default">归一化</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:your@email.com" class="iconfont icon-email" title="email"></a>
  <a href="http://aicesun.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2018
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">aice</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>
<script type="text/javascript" src="/dist/even.ece58db6.min.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      showProcessingMessages: false,
      messageStyle: 'none'
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"  integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>








</body>
</html>
